<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Vitrine Boutique</title>
  <style>
    /* =====================
       STYLES GÉNÉRAUX
       - Palette et police via variables CSS, injectées depuis data.json
       ===================== */
    :root{
      --color-primary: #111827; /* changée par JS selon data.json */
      --color-accent:  #2563eb; /* changée par JS selon data.json */
      --font-family:   Inter, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
    }
    html,body{height:100%}
    body{
      margin:0; font-family: var(--font-family);
      color:#111; background:#fff;
      -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
    }
    .container{max-width:1100px; margin:0 auto; padding:0 16px}

    /* =====================
       MICRO-ANIMATIONS LÉGÈRES
       ===================== */
    @keyframes fadeInUp{from{opacity:0; transform:translateY(10px)} to{opacity:1; transform:translateY(0)}}
    .fade-in{animation: fadeInUp .45s ease-out both}
    .card{transition: box-shadow .2s ease, transform .2s ease}
    .card:hover{box-shadow:0 10px 24px rgba(0,0,0,.08); transform:translateY(-2px)}

    /* =====================
       HEADER
       ===================== */
    header{border-bottom:1px solid #eee; background:#fff; position:sticky; top:0; z-index:10}
    .header-wrap{display:flex; align-items:center; justify-content:space-between; gap:16px; padding:14px 0}
    .brand{display:flex; align-items:center; gap:12px}
    .brand img{height:40px; width:40px; object-fit:contain}
    .title{font-size:1.5rem; font-weight:600}
    .badge{padding:4px 10px; border-radius:999px; font-size:.875rem; font-weight:600}
    .badge-open{background: #dcfce7; color:#166534}
    .badge-closed{background:#fee2e2; color:#991b1b}

    /* CONTACTS (affichés uniquement si fournis) */
    .contacts{display:flex; align-items:center; gap:18px}
    .contact{display:flex; align-items:center; gap:8px; font-size:.95rem; color:#222}
    .contact svg{width:18px; height:18px; fill: currentColor}

    /* =====================
       ANNONCE
       ===================== */
    .announcement{background: rgba(37, 99, 235, .06); color:#1f2937; border:1px solid #e5e7eb; border-radius:10px; padding:10px 12px; margin:16px 0}

    /* =====================
       GRILLE PRODUITS
       ===================== */
    .grid{display:grid; gap:16px; grid-template-columns:1fr}
    @media(min-width:720px){.grid{grid-template-columns:repeat(2,1fr)}}
    @media(min-width:1024px){.grid{grid-template-columns:repeat(3,1fr)}}
    .card{border:1px solid #eee; border-radius:14px; overflow:hidden; background:#fff}
    .card img{width:100%; height:190px; object-fit:cover; background:#fafafa}
    .card-body{padding:12px 14px}
    .card-title{font-size:1.05rem; font-weight:600; margin:0 0 6px}
    .price{opacity:.85; margin:0 0 8px}
    .desc{font-size:.95rem; color:#374151}
    .badge-stock{position:absolute; top:10px; left:10px; padding:4px 8px; border-radius:999px; font-size:.75rem; background:#fef3c7; color:#92400e}
    .card-wrap{position:relative}

    /* =====================
       THÈME VIA VARIABLES
       ===================== */
    .accent{color: var(--color-accent)}
    .primary{color: var(--color-primary)}
    .btn{display:inline-block; padding:8px 12px; border-radius:10px; border:1px solid var(--color-accent); color:var(--color-accent)}

    /* Footer simple */
    footer{border-top:1px solid #eee; margin-top:28px; padding:18px 0; font-size:.875rem; color:#6b7280}
  </style>
</head>
<body>
  <!-- HEADER: logo, titre, statut, contacts. Les contacts s’affichent seulement s’ils existent dans data.json -->
  <header>
    <div class="container header-wrap">
      <div class="brand fade-in">
        <!-- Remplacez le logo via settings.logo_url dans data.json -->
        <img id="logo" src="" alt="Logo boutique" />
        <div class="title primary" id="shopTitle">Boutique</div>
      </div>
      <div class="contacts">
        <span id="openBadge" class="badge">—</span>
        <!-- Téléphone, visible seulement si settings.phone non vide -->
        <div id="phoneBlock" class="contact" hidden>
          <!-- Icône téléphone SVG inline pour simplicité -->
          <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M6.62 10.79a15.053 15.053 0 0 0 6.59 6.59l2.2-2.2a1 1 0 0 1 1.01-.24c1.12.37 2.33.57 3.58.57a1 1 0 0 1 1 1v3.5a1 1 0 0 1-1 1C10.07 21 3 13.93 3 5.5a1 1 0 0 1 1-1H7.5a1 1 0 0 1 1 1c0 1.25.2 2.46.57 3.58a1 1 0 0 1-.24 1.01l-2.2 2.2z"/></svg>
          <span id="phoneText"></span>
        </div>
        <!-- Radio, visible seulement si settings.radio non vide -->
        <div id="radioBlock" class="contact" hidden>
          <!-- Icône tour radio SVG inline -->
          <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M12 2a1 1 0 0 1 1 1v2.07a7 7 0 0 1 4.93 4.93H20a1 1 0 1 1 0 2h-2.07A7 7 0 0 1 13 17.93V20a1 1 0 1 1-2 0v-2.07A7 7 0 0 1 6.07 12H4a1 1 0 1 1 0-2h2.07A7 7 0 0 1 11 5.07V3a1 1 0 0 1 1-1zm0 5a5 5 0 1 0 0 10 5 5 0 0 0 0-10z"/></svg>
          <span id="radioText"></span>
        </div>
      </div>
    </div>
  </header>

  <main class="container">
    <!-- Bandeau d’annonce, visible seulement si fourni -->
    <div id="announcement" class="announcement fade-in" hidden></div>

    <!-- Grille produits -->
    <section id="grid" class="grid" aria-live="polite"></section>

    <!-- Message d’erreur discrêt en cas d’échec fetch -->
    <p id="statusMsg" style="display:none; margin:14px 0; color:#b91c1c">Données indisponibles. Affichage d’un exemple local.</p>
  </main>

  <footer class="container">
    <span>Vitrine statique • Thème et contenu pilotés par <code>data.json</code></span>
  </footer>

  <script>
    // =====================
    // DONNÉES DE SECOURS (fallback)
    // - Utilisées si data.json est introuvable ou bloqué par le navigateur en file://
    // - Modifiez plutôt data.json pour votre vrai contenu
    // =====================
    const FALLBACK_DATA = {
      settings: {
        logo_url: "https://dummyimage.com/80x80/111827/ffffff&text=LOGO",
        shop_title: "Ma Boutique RP",
        phone: "",
        radio: "Canal 77.7 MHz",
        is_open: true,
        announcement: "Ouverture ce soir, offres spéciales roleplay.",
        theme_primary: "#111827",
        theme_accent: "#2563eb",
        font_family: "Inter, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif"
      },
      products: [
        {
          id:"p1",
          title:"Chaise Vintage",
          price:129.0,
          currency:"EUR",
          category:"Mobilier",
          tags:["bois","vintage"],
          image:"https://images.unsplash.com/photo-1540574163026-643ea20ade25?w=800&q=80&auto=format&fit=crop",
          in_stock:true,
          order:1,
          description:"Chaise en bois patiné, idéale pour votre vitrine RP."
        },
        {
          id:"p2",
          title:"Table Basse",
          price:199.9,
          currency:"EUR",
          category:"Salon",
          tags:["acier","industrieel"],
          image:"https://images.unsplash.com/photo-1519710164239-da123dc03ef4?w=800&q=80&auto=format&fit=crop",
          in_stock:false,
          order:2,
          description:"Plateau en chêne, structure acier."
        }
      ]
    };

    // =====================
    // UTILITAIRES
    // =====================
    function money(v, cur){
      const n = Number(v||0);
      // Format simple, évite Intl pour compat max sans config
      return n.toFixed(2) + ' ' + (cur||'EUR');
    }

    function setThemeAndFont(settings){
      // Applique thème et police depuis data.json
      document.documentElement.style.setProperty('--color-primary', settings.theme_primary || '#111827');
      document.documentElement.style.setProperty('--color-accent', settings.theme_accent || '#2563eb');
      document.documentElement.style.setProperty('--font-family', settings.font_family || 'Inter, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif');
    }

    function byOrder(a,b){
      const aa = Number(a.order ?? 9999);
      const bb = Number(b.order ?? 9999);
      return aa - bb;
    }

    // =====================
    // RENDU UI
    // =====================
    function renderAll(data){
      const {settings, products} = data;

      // Logo et titre
      const logo = document.getElementById('logo');
      logo.src = settings.logo_url || '';
      logo.alt = (settings.shop_title? settings.shop_title + ' — ' : '') + 'Logo';
      document.getElementById('shopTitle').textContent = settings.shop_title || 'Boutique';

      // Statut ouvert/fermé
      const openBadge = document.getElementById('openBadge');
      const isOpen = String(settings.is_open).toLowerCase() === 'true' || settings.is_open === true;
      openBadge.textContent = isOpen ? 'Ouvert' : 'Fermé';
      openBadge.className = 'badge ' + (isOpen? 'badge-open' : 'badge-closed');

      // Contacts: visibles seulement si champ non vide
      const phoneBlock = document.getElementById('phoneBlock');
      const radioBlock = document.getElementById('radioBlock');
      if(settings.phone){
        document.getElementById('phoneText').textContent = settings.phone;
        phoneBlock.hidden = false;
      } else { phoneBlock.hidden = true; }
      if(settings.radio){
        document.getElementById('radioText').textContent = settings.radio;
        radioBlock.hidden = false;
      } else { radioBlock.hidden = true; }

      // Annonce optionnelle
      const ann = document.getElementById('announcement');
      if(settings.announcement){ ann.textContent = settings.announcement; ann.hidden = false; }
      else { ann.hidden = true; }

      // Produits
      const grid = document.getElementById('grid');
      grid.innerHTML = '';
      (products||[]).slice().sort(byOrder).forEach(p => {
        // Carte produit simple, affiche badge "Indisponible" si in_stock=false
        const card = document.createElement('article');
        card.className = 'card fade-in';
        card.innerHTML = `
          <div class="card-wrap">
            ${p.in_stock === false ? '<div class="badge-stock">Indisponible</div>' : ''}
            <img src="${p.image||''}" alt="${(p.title||'Produit')}" loading="lazy" />
          </div>
          <div class="card-body">
            <h3 class="card-title primary">${p.title||'Sans titre'}</h3>
            <p class="price accent">${money(p.price, p.currency)}</p>
            <p class="desc">${p.description||''}</p>
          </div>
        `;
        grid.appendChild(card);
      });

      // Thème
      setThemeAndFont(settings);
    }

    // =====================
    // CHARGEMENT DES DONNÉES
    // =====================
    async function loadData(){
      const status = document.getElementById('statusMsg');
      try{
        // IMPORTANT: data.json doit être placé à côté de index.html
        const res = await fetch('data.json', {cache:'no-store'});
        if(!res.ok) throw new Error('HTTP ' + res.status);
        const data = await res.json();
        renderAll(data);
      }catch(err){
        // Cas courant si vous ouvrez directement le fichier en file:// dans le navigateur
        // Certains navigateurs bloquent fetch sur file://. On bascule alors sur le fallback.
        status.style.display = 'block';
        renderAll(FALLBACK_DATA);
      }
    }

    // Lancement
    loadData();
  </script>
</body>
</html>
