<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <title>ChosMarket</title>

  <!-- Favicon -->
  <link rel="icon" type="image/svg+xml"
    href='data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64"><rect width="64" height="64" rx="12" fill="%23111827"/><path d="M14 22h36l-3 22a6 6 0 0 1-6 5H23a6 6 0 0 1-6-5l-3-22z" fill="%232563eb"/></svg>'>

  <style>
    :root{
      --color-primary:#111827;   /* surchargé par data.json */
      --color-accent:#2563eb;    /* surchargé par data.json */
      --font-family:Inter, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;

      --bg:#0b0f19; --bg-soft:#0f1526; --panel:#111827;
      --text:#e6e9ef; --muted:#a7b0c3; --border:#1f2a44;
      --cta:#ef4444; /* rouge */
      --cta2:#f97316; /* orange */
      --shadow:rgba(0,0,0,.45);
    }

    @media (prefers-reduced-motion:no-preference){
      @keyframes rise{from{opacity:0;transform:translateY(6px)} to{opacity:1;transform:none}}
      .fade-in{animation:rise .35s ease-out both}
    }

    html,body{height:100%}
    body{
      margin:0; font-family:var(--font-family);
      color:var(--text); background:var(--bg);
      -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
      background-image:
        radial-gradient(900px 500px at 15% -10%, rgba(37,99,235,.14), transparent 60%),
        radial-gradient(1000px 500px at 100% 0%, rgba(37,99,235,.10), transparent 55%),
        linear-gradient(180deg,#0b0f19 0%,#0a0d16 100%);
    }
    .container{max-width:1200px; margin:0 auto; padding:0 24px}

    /* Header */
    header{
      position:sticky; top:0; z-index:20;
      background:rgba(10,14,24,.6);
      backdrop-filter:blur(10px) saturate(130%);
      border-bottom:1px solid var(--border);
    }
    .header-wrap{display:flex; align-items:center; justify-content:space-between; gap:16px; padding:16px 0}
    .brand{display:flex; align-items:center; gap:12px}
    .brand img{height:56px; width:56px; object-fit:contain; filter:drop-shadow(0 4px 10px var(--shadow))}
    .title{font-size:1.8rem; font-weight:800; letter-spacing:.2px}

    /* Info téléphone / radio (non cliquables) */
    .actions{display:flex; align-items:center; gap:12px}
    .pill{
      display:inline-flex; align-items:center; gap:10px;
      padding:10px 14px; border-radius:999px;
      background:linear-gradient(135deg,var(--cta),var(--cta2));
      color:#fff; font-weight:800; letter-spacing:.3px;
      border:1px solid rgba(0,0,0,.15);
      box-shadow:0 6px 14px rgba(249,115,22,.22);
      user-select:text;
    }
    .pill svg{width:18px; height:18px; fill:currentColor}
    .pill[hidden]{display:none !important}

    /* Annonce centrée plus petite + espacement généreux en dessous */
    .hero{
      text-align:center;
      margin:24px 0 36px 0;       /* espace au dessus */
      padding:0;
    }
    .hero-line{
      font-weight:900; text-transform:uppercase; letter-spacing:.12em;
      /* plus petit que le logo (1.8rem) */
      font-size:clamp(1rem, 1.4rem + 1vw, 1.5rem);
      color:#eef2ff;
    }
    .hero-sub{margin-top:6px; color:var(--muted); font-weight:600}
    .spacer-below-hero{height:28px}  /* pousse les filtres et la grille vers le bas */
    .hero[hidden]{display:none !important}

    /* Filtres catégories lisibles même inactifs */
    .filters{display:flex; flex-wrap:wrap; gap:10px; margin:0 0 18px}
    .chip{
      padding:8px 12px; border-radius:999px; font-weight:700; font-size:.9rem;
      border:1px solid #324064;
      background:#1a2236;          /* lisible sur fond sombre */
      color:#cbd5e1;
      cursor:pointer; user-select:none;
    }
    .chip:hover{filter:brightness(1.1)}
    .chip[aria-pressed="true"]{
      border-color:color-mix(in oklab, var(--color-accent) 65%, var(--border));
      background:linear-gradient(180deg, rgba(37,99,235,.35), rgba(37,99,235,.15));
      color:#fff;
    }
    .chip:focus-visible{outline:2px solid var(--color-accent); outline-offset:2px}

    /* Sections par catégorie */
    .section{margin:18px 0 8px}
    .section h2{
      font-size:1.05rem; font-weight:900; letter-spacing:.06em; text-transform:uppercase;
      margin:8px 0 10px; color:#eaf0ff;
      border-left:4px solid var(--color-accent); padding-left:10px;
    }

    /* Grille vignettes */
    .grid{display:grid; gap:14px; grid-template-columns:repeat(auto-fill,minmax(180px,1fr))}
    .card{
      background:linear-gradient(180deg, rgba(255,255,255,.02), rgba(255,255,255,.00));
      border:1px solid var(--border);
      border-radius:16px; overflow:hidden;
      box-shadow:0 6px 16px var(--shadow);
      transition:transform .15s ease, box-shadow .15s ease, border-color .15s ease;
      backdrop-filter:saturate(120%) blur(6px);
    }
    .card:hover{transform:translateY(-2px); border-color:color-mix(in oklab, var(--color-accent) 40%, var(--border))}
    .thumb{width:100%; height:140px; object-fit:cover; background:#0b1220}
    .body{padding:10px 12px}
    .title-sm{font-size:1rem; font-weight:800; margin:0 0 6px}
    .price{margin:0 0 6px; font-weight:800; color:var(--color-accent)}
    .desc{font-size:.9rem; color:var(--muted); line-height:1.35}
    /* tags masqués visuellement (conservés dans data.json) */
    .tags{display:none}

    .oos{
      position:absolute; top:8px; left:8px; padding:6px 10px; border-radius:999px; font-size:.72rem;
      background:linear-gradient(180deg, rgba(251,191,36,.22), rgba(251,191,36,.10)); color:#fde68a;
      border:1px solid rgba(251,191,36,.35); backdrop-filter:blur(4px);
    }
    .wrap{position:relative}

    footer{border-top:1px solid var(--border); margin-top:28px; padding:18px 0; font-size:.875rem; color:var(--muted)}

    /* --- Fix mobile layout/zoom/pan --- */
    *, *::before, *::after { box-sizing: border-box; }
    html, body { width: 100%; max-width: 100%; overflow-x: hidden; }
    img, video { max-width: 100%; height: auto; display: block; }
    body { touch-action: manipulation; -webkit-text-size-adjust: 100%; }

    .container { padding-left: 16px; padding-right: 16px; }
    @media (max-width: 380px) {
      .container { padding-left: 12px; padding-right: 12px; }
    }

    .grid { grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 12px; }
    @media (max-width: 360px) {
      .grid { grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap: 10px; }
    }

    .card { border-radius: 14px; }
    .title-sm { font-size: .95rem; }
    .desc { font-size: .88rem; line-height: 1.4; }
    .thumb { height: 128px; }
  </style>
</head>
<body>
  <!-- HEADER -->
  <header>
    <div class="container header-wrap">
      <div class="brand fade-in">
        <img id="logo" src="" alt="Logo boutique" />
        <div class="title" id="shopTitle">Boutique</div>
      </div>

      <div class="actions">
        <!-- Téléphone: non cliquable -->
        <div id="phonePill" class="pill" hidden>
          <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M6.62 10.79a15.053 15.053 0 0 0 6.59 6.59l2.2-2.2a1 1 0 0 1 1.01-.24c1.12.37 2.33.57 3.58.57a1 1 0 0 1 1 1v3.5a1 1 0 0 1-1 1C10.07 21 3 13.93 3 5.5a1 1 0 0 1 1-1H7.5a1 1 0 0 1 1 1c0 1.25.2 2.46.57 3.58a1 1 0 0 1-.24 1.01l-2.2 2.2z"/></svg>
          <span id="phoneText"></span>
        </div>
        <!-- Radio: non cliquable, icône talkie -->
        <div id="radioPill" class="pill" hidden>
          <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M7 2h10v2H7zM8 5h8a3 3 0 0 1 3 3v8a4 4 0 0 1-4 4H9a4 4 0 0 1-4-4V8a3 3 0 0 1 3-3zm0 4v7a2 2 0 0 0 2 2h4a2 2 0 0 0 2-2V9H8zm6 3.5a1.5 1.5 0 1 1-3.001.001A1.5 1.5 0 0 1 14 12.5z"/></svg>
          <span id="radioText"></span>
        </div>
      </div>
    </div>
  </header>

  <main class="container">
    <!-- Annonce centrée plus petite -->
    <section id="hero" class="hero" hidden>
      <div id="heroLine" class="hero-line"></div>
      <div id="heroSub" class="hero-sub"></div>
    </section>
    <div class="spacer-below-hero"></div>

    <!-- Filtres -->
    <div class="filters" id="filters" aria-label="Filtres catégories"></div>

    <!-- Sections catégories -->
    <div id="sections"></div>

    <p id="statusMsg" style="display:none; margin:14px 0; color:#fca5a5">Données indisponibles. Affichage d’un exemple local.</p>
  </main>

  <footer class="container">
    <span>Shop propulsé par Larry Call pour ChosMarket sur HomeLife • Tout droit réservé 2025</span>
  </footer>

  <script>
    /* ===== Fallback minimal ===== */
    const FALLBACK_DATA = {
      settings: {
        logo_url: "https://dummyimage.com/80x80/111827/ffffff&text=LOGO",
        shop_title: "Ma Boutique RP",
        phone: "",
        radio: "",
        is_open: true,
        announcement: "OUVERTURE CE SOIR 20H",
        theme_primary: "#111827",
        theme_accent: "#2563eb",
        font_family: "Inter, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif"
      },
      products: []
    };

    /* ===== Utils ===== */
    const hasText = v => typeof v === 'string' ? v.trim().length > 0 : Boolean(v);

    // Affiche prix en euros SANS centimes, avec séparateur thousands FR (ex: 3 500 €)
    function priceEUR(value){
      const n = Math.round(Number(value||0));
      return n.toLocaleString('fr-FR') + ' €';
    }

    const byOrder = (a,b) => Number(a.order ?? 9999) - Number(b.order ?? 9999);

    function setThemeAndFont(s){
      document.documentElement.style.setProperty('--color-primary', s.theme_primary || '#111827');
      document.documentElement.style.setProperty('--color-accent',  s.theme_accent  || '#2563eb');
      document.documentElement.style.setProperty('--font-family',   s.font_family   || 'Inter, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif');
    }

    /* ===== Rendu header + hero ===== */
    function renderHeader(settings){
      // Logo + titre
      const logo = document.getElementById('logo');
      logo.src = settings.logo_url || '';
      logo.alt = (settings.shop_title? settings.shop_title+' — ' : '') + 'Logo';
      document.getElementById('shopTitle').textContent = settings.shop_title || 'Boutique';

      // Téléphone (non cliquable)
      const phonePill = document.getElementById('phonePill');
      if(hasText(settings.phone)){
        document.getElementById('phoneText').textContent = String(settings.phone).trim();
        phonePill.hidden = false;
      } else {
        phonePill.hidden = true;
        document.getElementById('phoneText').textContent = '';
      }

      // Radio (non cliquable)
      const radioPill = document.getElementById('radioPill');
      if(hasText(settings.radio)){
        document.getElementById('radioText').textContent = String(settings.radio).trim();
        radioPill.hidden = false;
      } else {
        radioPill.hidden = true;
        document.getElementById('radioText').textContent = '';
      }

      // Annonce centrée
      const hero = document.getElementById('hero');
      if(hasText(settings.announcement)){
        document.getElementById('heroLine').textContent = settings.announcement.trim().toUpperCase();
        document.getElementById('heroSub').textContent = '';
        hero.hidden = false;
      } else {
        hero.hidden = true;
      }

      // Thème
      setThemeAndFont(settings);
    }

    /* ===== Indexation catégories ===== */
    function buildCategoryIndex(products){
      const map = new Map();
      products.forEach(p=>{
        const cat = hasText(p.category) ? String(p.category).trim() : 'Divers';
        if(!map.has(cat)) map.set(cat, []);
        map.get(cat).push(p);
      });
      for(const arr of map.values()){ arr.sort(byOrder); }
      return map;
    }

    /* ===== Filtres et sections ===== */
    function renderFilters(categories){
      const filters = document.getElementById('filters');
      filters.innerHTML = '';

      function setActive(btn){
        for(const el of filters.querySelectorAll('.chip')) el.setAttribute('aria-pressed','false');
        btn.setAttribute('aria-pressed','true');
      }

      const allChip = document.createElement('button');
      allChip.className='chip';
      allChip.textContent='Toutes';
      allChip.setAttribute('aria-pressed','true');
      allChip.addEventListener('click', ()=>{ setActive(allChip); applyFilter(null); });
      filters.appendChild(allChip);

      categories.forEach(cat=>{
        const b = document.createElement('button');
        b.className='chip';
        b.textContent=cat;
        b.addEventListener('click', ()=>{ setActive(b); applyFilter(cat); });
        filters.appendChild(b);
      });
    }

    function cardHTML(p){
      return `
        <article class="card fade-in">
          <div class="wrap">
            ${p.in_stock === false ? '<div class="oos">Indisponible</div>' : ''}
            <img class="thumb" src="${p.image||''}" alt="${(p.title||'Produit')}" loading="lazy" />
          </div>
          <div class="body">
            <h3 class="title-sm">${p.title||'Sans titre'}</h3>
            <p class="price">${priceEUR(p.price)}</p>
            <p class="desc">${p.description||''}</p>
            <!-- tags cachés volontairement -->
          </div>
        </article>`;
    }

    let CATEGORY_INDEX = new Map();

    function renderSections(filterCat=null){
      const root = document.getElementById('sections');
      root.innerHTML = '';
      const cats = [...CATEGORY_INDEX.keys()].sort((a,b)=>a.localeCompare(b,'fr',{sensitivity:'base'}));
      const toRender = filterCat ? cats.filter(c=>c===filterCat) : cats;

      toRender.forEach(cat=>{
        const sec = document.createElement('section');
        sec.className='section';
        sec.innerHTML = `<h2>${cat}</h2><div class="grid">${CATEGORY_INDEX.get(cat).map(cardHTML).join('')}</div>`;
        root.appendChild(sec);
      });
    }

    function applyFilter(cat){
      renderSections(cat);
      // scroll vers le début des sections pour lisibilité
      document.getElementById('sections').scrollIntoView({behavior:'smooth', block:'start'});
    }

    /* ===== Chargement ===== */
    async function loadData(){
      const status = document.getElementById('statusMsg');
      try{
        const res = await fetch('./data.json', {cache:'no-store'});
        if(!res.ok) throw new Error('HTTP ' + res.status);
        const data = await res.json();
        start(data);
      }catch(e){
        status.style.display='block';
        start(FALLBACK_DATA);
      }
    }

    function start(data){
      const settings = data.settings || {};
      const products = Array.isArray(data.products) ? data.products : [];
      renderHeader(settings);
      CATEGORY_INDEX = buildCategoryIndex(products);
      renderFilters([...CATEGORY_INDEX.keys()]);
      renderSections(null);
    }

    loadData();
  </script>
</body>
</html>
